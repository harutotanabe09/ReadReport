＃読書レポート

## 図解でなっとく！トラブルしらずのシステム設計

### ＊　読んだきっかけ

・ここ最近Salesforceで不具合をだしたため、どうすれば不具合のないシステムを作れるかという悩みを抱えていた時、偶然目に留まった１冊の本。

### ＊　本の内容

・DBのパフォーマンスチューニングするのにベストかと思う。SQLを学んだ一歩先にある内容。

　図解で漫画で書かれてわかりやすい。

　事例がよく現場であるあるネタが書かれているため、即実行できる内容になっている。

### ＊　学び

・全件よりページング。全件表示は、メモリ領域を使う。よくない。

・メモリは以下で決まる。

　１．利用者数　２．サーバーのメモリサイズ　３．データの生存期間

・ページングするときはソートできるようにするとユーザがデータたどりやすい

・戻るは、ブラウザの戻るボタンもあるし、そっちはブラウザにより挙動異なるので厄介。

・キャッシュとノーキャッシュ

　キャッシュの実装は、HTTP1.0とHTTP1.1で仕様が違うから注意

　ノーキャッシュはセキリティ上デメリットあり

・戻るボタンを押すとデータ登録される問題

・2重登録防止　ー　PRGパターンを使う。2重送信防止。セッション切る。

・P（Post)　R（Redirect)　G（Get)　→　POSTとGETの制御明確にする必要あり

・2重送信防止機能は、トークンで制御すること

・小画面は、モーダルで制御　OR　モードレス。親画面見れるか見れないかの違い

・モードレスは、DB不整合起こすので対策必要

　対策１．WindowID指定して複数発の禁止

　対策２．セッション方式（サーバ上に保持）：利用者数増加だとOOM（OutOfMemory）しやすい

・SQLの実行計画でフルスキャンとインデックススキャンを見極める

・インデックスは部分一致や後方一致きかない、データ分布が少ないときかない

・インデックスは結合のキー項目につけるのがセオリー。

・データ抽出は、テーブルを結合しないといけないという固定概念を捨てるのも大事。

・結合せずに結合元に項目を移動させるのも一つの手。（非正規化）結合ない分早く参照できる。